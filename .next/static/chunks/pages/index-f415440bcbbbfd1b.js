(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(5989)}])},1398:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(5893),a=r(9008),s=r.n(a),i=r(1664),o=r.n(i);function l(e){let{children:t}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)(s(),{children:[(0,n.jsx)("title",{children:"Warriors Game AI Commentary"}),(0,n.jsx)("meta",{name:"description",content:"AI-powered commentary for Warriors games"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)("nav",{className:"bg-black text-neon-green p-4",children:(0,n.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,n.jsx)(o(),{href:"/",className:"text-2xl font-bold text-neon-green",children:"Warriors AI Commentary"}),(0,n.jsxs)("ul",{className:"flex space-x-4",children:[(0,n.jsx)("li",{children:(0,n.jsx)(o(),{href:"/",className:"hover:text-green-400",children:"Home"})}),(0,n.jsx)("li",{children:(0,n.jsx)(o(),{href:"/analytics",className:"hover:text-green-400",children:"Analytics"})})]})]})}),(0,n.jsx)("main",{children:t})]})}},5989:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var n=r(5893),a=r(1398),s=r(7294);function i(e){let{commentary:t,onSendMessage:r,showAIMessages:a,onToggleAIMessages:i,onGenerateCommentary:o,isAIWatching:l,isSpeaking:c}=e,d=(0,s.useRef)(null),[h,m]=(0,s.useState)("");return(0,s.useEffect)(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[t]),(0,n.jsxs)("div",{className:"commentary bg-black rounded-lg flex flex-col h-full",children:[(0,n.jsxs)("div",{className:"p-4 bg-black border-b border-gray-600",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2 text-neon-green",children:"Live Chat"}),(0,n.jsx)("button",{onClick:i,className:"bg-green-600 text-white px-4 py-2 rounded-md w-full hover:bg-green-700",children:a?"Hide AI Messages":"Show AI Messages"})]}),(0,n.jsx)("div",{className:"flex-grow overflow-y-auto p-4 bg-black",ref:d,children:(0,n.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>(a||"ai"!==e.type)&&(0,n.jsxs)("div",{className:"p-3 rounded shadow ".concat("user"===e.type?"bg-green-600 text-white text-right":"bg-gray-700"),children:[(0,n.jsx)("p",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleTimeString()}),(0,n.jsx)("p",{className:"mt-1",children:e.text})]},t))})}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),h.trim()&&(r(h),m(""))},className:"p-4 bg-black border-t border-gray-600 flex gap-2",children:[(0,n.jsx)("input",{type:"text",value:h,onChange:e=>m(e.target.value),placeholder:"Type your message...",className:"flex-grow px-3 py-2 bg-gray-600 text-white rounded-l-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),(0,n.jsx)("button",{type:"submit",className:"send bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Send"}),(0,n.jsx)("button",{type:"button",onClick:o,className:"generate-commentary bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",disabled:l||c,children:l?"Generating...":c?"Speaking...":"Generate"})]})]})}var o=r(1193),l=r.n(o),c=r(2305),d=r(5043),h=r(4206),m=r(2154),x=r(4283),g=r(6910),u=r(3447),p=r(9949),y=r(2332),f=r(8933);function j(e){let{videoSrc:t}=e,r=(0,s.useRef)(null),[a,o]=(0,s.useState)(null),[j,v]=(0,s.useState)([]),[b,w]=(0,s.useState)(!0),[N,k]=(0,s.useState)(!1),[S,C]=(0,s.useState)(!1),[E,A]=(0,s.useState)(null),T=async()=>{try{let e=await fetch("/api/analytics"),t=await e.json();A(t)}catch(e){console.error("Error fetching latest analytics:",e)}};(0,s.useEffect)(()=>{let e;let t=r.current,n=0,a=r=>{if(r-n>=2e3&&t.readyState>=t.HAVE_CURRENT_DATA){let e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.log("Capturing frame:",e.width,"x",e.height);let a=e.toDataURL("image/jpeg");k(!0),fetch("/api/commentary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageData:a,width:e.width,height:e.height})}).then(e=>e.json()).then(e=>{console.log("Commentary generated:",e),v(t=>{let r=[...t,{...e,type:"ai"}];return T(),r}),k(!1)}).catch(e=>{console.error("Error generating commentary:",e),o("Error generating commentary. Please check the console for details."),k(!1)}),n=r}e=requestAnimationFrame(a)},s=()=>{console.log("Video playback started"),e=requestAnimationFrame(a)},i=()=>{console.log("Video playback paused"),cancelAnimationFrame(e),k(!1)},l=e=>{console.error("Video error:",e),o("Error loading video. Please check the video source.")};return t.addEventListener("play",s),t.addEventListener("pause",i),t.addEventListener("error",l),T(),()=>{t.removeEventListener("play",s),t.removeEventListener("pause",i),t.removeEventListener("error",l),cancelAnimationFrame(e)}},[]);let _=async()=>{try{k(!0);let e=document.createElement("canvas"),t=r.current;e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height);let n=e.toDataURL("image/jpeg"),a=await fetch("/api/commentary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageData:n,width:e.width,height:e.height})}),s=await a.json();s.text&&(v(e=>{let t=[...e,{...s,type:"ai"}];return T(),t}),D(s.text)),k(!1)}catch(e){console.error("Error generating commentary:",e),o("Error generating commentary. Please check the console for details."),k(!1)}},D=async e=>{C(!0);let t=r.current;t.muted=!0;try{let r=await fetch("/api/text-to-speech",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})}),n=new(window.AudioContext||window.webkitAudioContext),a=n.createBufferSource(),s=await r.arrayBuffer();n.decodeAudioData(s,e=>{a.buffer=e,a.connect(n.destination),a.start(0)}),a.onended=()=>{t.muted=!1,C(!1)}}catch(e){console.error("Error playing speech from server:",e),t.muted=!1,C(!1)}};return(0,n.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,n.jsxs)("div",{className:"flex-grow flex",children:[(0,n.jsxs)("div",{className:"w-2/3 p-4",children:[(0,n.jsx)("video",{ref:r,src:t,controls:!0,crossOrigin:"anonymous",className:"w-full h-full object-cover bg-black border border-gray-700"}),a&&(0,n.jsx)("p",{className:"text-red-500 mt-2",children:a}),N&&(0,n.jsx)("div",{className:"absolute top-4 right-4 bg-gray-500 bg-opacity-50 text-white px-2 py-1 rounded animate-pulse",children:"AI is watching"})]}),(0,n.jsx)("div",{className:"w-1/3 p-4",children:(0,n.jsx)(i,{commentary:j,showAIMessages:b,onToggleAIMessages:()=>w(!b),onGenerateCommentary:_,isAIWatching:N,isSpeaking:S,onSendMessage:e=>{let t={timestamp:new Date().toISOString(),text:e,type:"user"};v(e=>{let r=[...e,t];return T(),r})}})})]}),(0,n.jsx)("div",{className:"flex-shrink-0 h-1/3 bg-black p-4 overflow-x-auto",children:(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(l(),{children:(0,n.jsxs)("div",{className:"bg-gray-800 p-4 rounded-lg cursor-move",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2 text-neon-green",children:"Total Commentaries"}),(0,n.jsx)(e=>{let{total:t}=e;return(0,n.jsx)("div",{style:{width:"300px",height:"200px"},children:(0,n.jsx)(c.h,{width:"100%",height:"100%",children:(0,n.jsxs)(d.v,{data:[{name:"Total Commentaries",total:t}],children:[(0,n.jsx)(h.q,{strokeDasharray:"3 3"}),(0,n.jsx)(m.K,{dataKey:"name"}),(0,n.jsx)(x.B,{}),(0,n.jsx)(g.u,{}),(0,n.jsx)(u.D,{}),(0,n.jsx)(p.$,{dataKey:"total",fill:"#8884d8"})]})})})},{total:(null==E?void 0:E.totalCommentaries)||0})]})}),(0,n.jsx)(l(),{children:(0,n.jsxs)("div",{className:"bg-gray-800 p-4 rounded-lg cursor-move",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2 text-neon-green",children:"Latest Commentaries"}),(0,n.jsx)(e=>{let{commentaries:t=[]}=e,r=t.map(e=>({timestamp:new Date(e.timestamp).toLocaleString(),length:e.commentary.length})).reverse();return(0,n.jsx)("div",{style:{width:"300px",height:"200px"},children:(0,n.jsx)(c.h,{width:"100%",height:"100%",children:(0,n.jsxs)(y.w,{data:r,children:[(0,n.jsx)(h.q,{strokeDasharray:"3 3"}),(0,n.jsx)(m.K,{dataKey:"timestamp"}),(0,n.jsx)(x.B,{}),(0,n.jsx)(g.u,{}),(0,n.jsx)(u.D,{}),(0,n.jsx)(f.x,{type:"monotone",dataKey:"length",stroke:"#8884d8"})]})})})},{commentaries:(null==E?void 0:E.latestCommentaries)||[]})]})})]})})]})}function v(){return(0,n.jsx)(a.Z,{children:(0,n.jsx)(j,{videoSrc:"/sample-video.mp4"})})}}},function(e){e.O(0,[878,193,888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);